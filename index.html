<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/normalize.css" />
    <link rel="stylesheet" href="./css/accordion.css" />
    <link rel="stylesheet" href="./css/search.css" />
    <link rel="stylesheet" href="./css/icons.css" />
    <link rel="stylesheet" href="./css/loading.css" />
</head>

<body>

    <div class="container">
        <search id="main-search" class="search">
            <div class="search-input-wrapper">
                <input aria-controls="search-suggests" id="main-search-input" aria-expanded="false"
                    aria-autocomplete="list" role="combobox" class="search-input" type="search"
                    placeholder="Pesquisar..." />
                <div class="right">
                    <button>
                        <i class="fa-solid fa-magnifying-glass magnifier-glass"></i>
                    </button>
                </div>
            </div>
            <section id="search-suggests" aria-busy="true" aria-label="suggests" class="search-dropdown"></section>
        </search>
        <section id="accordion-wrapper" aria-busy="true"></section>
    </div>

    <!-- scripts -->
    <script src="https://kit.fontawesome.com/150fbb0499.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="./js/components/AccordionNode.js"></script>
    <script src="./js/components/SuggestNode.js"></script>
    <script src="./js/components/Loading.js"></script>
    <script src="./js/constants/index.js"></script>
    <script src="./js/utils/index.js"></script>
    <script src="./js/utils/search.js"></script>
    <script src="./js/utils/accordion.js"></script>
    <script src="./js/mock/accordionData.js"></script>
    <script src="./js/mock/suggestsData.js"></script>
    <script>
        $(() => {

            // accordions
            const accordionWrapper = $("#accordion-wrapper")
            accordionWrapper.html(Loading);
            $.get("https://api.adviceslip.com/advice", (data, status) => {
                resetElement(accordionWrapper);
                accordionData[4].description = JSON.parse(data).slip.advice;
                appendAccordions(accordionData);
                setAccordionToggleSlide();
                $(".accordion:first").addClass('show');
                accordionWrapper.attr('aria-busy', false);
            })


            // search
            const search = $("#main-search");
            const mainInput = $("#main-search-input");
            const mainSearchDropdown = $("#main-search #search-suggests")

            search.on({
                'blur': (e) => removeWithExpandElement(mainInput, mainSearchDropdown),
                'focus': (e, paramEvent) => {
                    openWithExpandElement(mainInput, mainSearchDropdown);
                    mainSearchDropdown.html(Loading);
                    (async () => {
                        await appendSuggests(await updateSuggests(paramEvent))
                        mainSearchDropdown.find('.loading').remove();
                    })()
                },
                'keyup': (e) => e.keyCode == 27 ? search.trigger('blur') : search.trigger('focus', e)
            }).on({
                'focus': (e) => search.trigger('focus', e)
            }, '.search-input');

            $(window).on({
                "click": (e) => {
                    const thereIsSearchParent = $(e.target).closest('.search').length != 0;
                    if (!thereIsSearchParent) search.trigger('blur');
                }
            })

        })
    </script>
</body>

</html>