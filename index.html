<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boilerplates</title>
    <link rel="stylesheet" href="./css/normalize.css" />
    <link rel="stylesheet" href="./css/accordion.css" />
    <link rel="stylesheet" href="./css/search.css" />
    <link rel="stylesheet" href="./css/icons.css" />
    <link rel="stylesheet" href="./css/loading.css" />
</head>

<body>

    <div class="container">
        <search id="main-search" class="search">
            <div class="search-input-wrapper">
                <input aria-controls="search-suggests" id="main-search-input" aria-expanded="false"
                    aria-autocomplete="list" role="combobox" class="search-input" type="search"
                    placeholder="Pesquisar..." />
                <div class="right">
                    <button id="reset-main-search-input" class="show">
                        <i class="fa-solid fa-xmark icon close"></i>
                    </button>
                    <button>
                        <i class="fa-solid fa-magnifying-glass magnifier-glass icon"></i>
                    </button>
                </div>
            </div>
            <section id="search-suggests" tabindex="-1" aria-busy="true" aria-label="suggests" class="search-dropdown">
            </section>
        </search>
        <section id="accordion-wrapper" aria-busy="true"></section>
    </div>

    <!-- scripts -->
    <script src="https://kit.fontawesome.com/150fbb0499.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="./js/components/AccordionNode.js"></script>
    <script src="./js/components/SuggestNode.js"></script>
    <script src="./js/components/Loading.js"></script>
    <script src="./js/constants/index.js"></script>
    <script src="./js/utils/index.js"></script>
    <script src="./js/utils/search.js"></script>
    <script src="./js/utils/accordion.js"></script>
    <script src="./js/mock/accordionData.js"></script>
    <script src="./js/mock/suggestsData.js"></script>
    <script>
        $(() => {

            // accordions
            const accordionWrapper = $("#accordion-wrapper")
            accordionWrapper.html(Loading);
            $.get("https://api.adviceslip.com/advice", (data, status) => {
                resetElement(accordionWrapper);
                accordionData[4].description = JSON.parse(data).slip.advice;
                appendAccordions(accordionData);
                setAccordionToggleSlide();
                $(".accordion:first").addClass('show');
                accordionWrapper.attr('aria-busy', false);
            })


            // search
            const search = $("#main-search");
            const mainInput = $("#main-search-input");
            const mainSearchDropdown = $("#main-search #search-suggests");
            const resetInputBtn = $('#reset-main-search-input');

            const loadMainSearchDropdown = () => {
                mainSearchDropdown.html(Loading);
                mainSearchDropdown.attr('aria-busy', true);
                (async () => {
                    const suggests = await updateSuggests(mainInput.val());
                    (suggests.length == 0) ?
                        mainSearchDropdown.html('<div class="item"><p class="container">Dado n√£o encontrado...</p></div>')
                        : appendSuggests(suggests);
                    mainSearchDropdown.find('.loading').remove();
                    mainSearchDropdown.attr('aria-busy', false);
                })()
            }

            search.on({
                'focus click keyup': (e) => {
                    if (mainInput.val().length == 0) {
                        removeWithExpandElement(mainInput, mainSearchDropdown)
                        resetInputBtn.removeClass('show');
                        return;
                    };
                    resetInputBtn.addClass('show');
                    openWithExpandElement(mainInput, mainSearchDropdown);
                    loadMainSearchDropdown();
                },
            }, '.search-input');

            resetInputBtn.on("click", () => {
                mainInput.val('');
                mainInput.trigger('focus');
            })

            $(window).on({
                "keyup": (e) => {
                    if (e.key == "Escape") removeWithExpandElement(mainInput, mainSearchDropdown);
                },
                "click": (e) => {
                    const thereIsSearchParent = $(e.target).closest('.search').length != 0;
                    if (!thereIsSearchParent) search.trigger('blur');
                }
            })

        })
    </script>
</body>

</html>